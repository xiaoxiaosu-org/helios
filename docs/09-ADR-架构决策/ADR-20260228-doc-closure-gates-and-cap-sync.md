# ADR-20260228: 文档闭环门禁与 CAP 状态同步落地

## 状态
Accepted

## 日期
2026-02-28

## 背景
- 当前仓库已具备文档目录结构与基础门禁，但仍存在“能力脚本未闭环、路线图状态与验收结果漂移、质量评分手工维护滞后”的问题。
- 在 CI 中，关键治理文档与架构执行计划变更会触发 ADR 强制规则，需要以 ADR 形式沉淀“为何引入新门禁与自动同步机制”。

## 决策
- 补齐 CAP-002/003/005/008/010 的最小可执行验收入口，使执行计划中的能力项具备机械可验基础。
- 新增 `scripts/ci/cap-plan-sync-check.sh`，对路线图 CAP 状态与验收返回码进行一致性校验，并作为 CI 硬门禁。
- 新增 `scripts/docs/update-quality-score.sh`，将质量评分文档改为自动汇总区块并在 CI 执行 `--check` 校验。
- 收紧 workflow `close` 逻辑：当 `close_checks` 配置了 `cap_status_done` 与 `adr_required` 时必须真实执行，不再仅依赖流程文本约定。
- 引入 `scripts/docs/gardening.sh` 与定时 workflow，形成文档索引/链接的周期性熵控制机制。

## 影响

### 正面影响
- “文档结构闭环”升级为“能力可执行闭环”，减少仅靠文本约束带来的失真。
- 执行计划状态与验收结果形成双向约束，降低 CAP 状态漂移风险。
- 质量评分从手工快照转为脚本汇总与 CI 校验，提升一致性与可审计性。
- Doc gardening 周期巡检降低文档长期演进中的断链和索引退化风险。

### 负面影响
- CI 门禁项增多，短期内会增加提交与推送阶段的失败反馈频次。
- 最小实现策略在业务代码落地后仍需持续迭代，否则规则会出现覆盖不足。

## 备选方案
- 保持现状，仅依赖人工维护路线图状态与质量评分：拒绝，无法稳定避免状态漂移。
- 只在 PR 模板中要求“手工同步”而不加门禁：拒绝，缺乏机械约束，长期容易失效。
- 一次性引入完整多语言日志/可观测平台规则：暂不采用，当前阶段先落最小可验实现，后续按业务复杂度扩展。

## 版本影响
- 是否影响 API：否
- 是否影响事件模型：否
- 是否影响数据结构：否
