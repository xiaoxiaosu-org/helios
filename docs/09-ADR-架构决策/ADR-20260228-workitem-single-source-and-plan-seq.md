# ADR-20260228-workitem-single-source-and-plan-seq: WorkItem 单一执行源与计划日内序号策略

## 状态
- 已采纳

---

## 背景

工程治理从 TD/CAP 并行口径迁移到统一的 WorkItem 模型后，仍存在两个关键风险：

1. 计划与任务编号在多专题并行时容易冲突，且人工维护成本高。
2. 执行源、模板、门禁与看板如果不同步，长期会出现“规则存在但无法稳定执行”的漂移。

此前体系还存在长期 `in_progress` 总账项难以收口的问题，导致计划进度信号失真。

---

## 决策

1. 统一执行主源为 `docs/02-架构/执行计划/backlog.yaml`，不再兼容旧 `workflow-map.yaml` 执行入口。
2. 统一编号模型：
   - `planId = PLAN-YYYYMMDD-NN`
   - `workItemId = WI-PLANYYYYMMDDNN-NN`
3. 引入 `scripts/workflow/plan-add.sh` 自动分配当日序号（`NN`），并自动创建首个 WorkItem 与计划文档骨架。
4. 将模板、脚本、CI 门禁、总览看板与文档索引绑定到同一编号与字段语义，防止长期漂移。
5. 对长期在制总账项采用“拆分子项 + 在制 SLA 门禁 + 收口策略”推进，不再以无限期 `in_progress` 作为默认策略。

---

## 影响

### 正面影响
- 计划/任务编号可自动生成并避免同日冲突，降低人工维护风险。
- 门禁可以机械校验计划模板、编号归属、文档联动与执行一致性。
- 治理能力可通过脚本与基线目录跨项目复刻，减少“靠人提醒”。

### 负面影响
- 旧 TD/CAP 直接执行命令不再兼容，需要迁移到 `WI-PLAN*` 入口。
- 初期迁移会增加一次性改造成本（文档重命名、脚本改造、门禁重对齐）。

---

## 替代方案

1. 保留 TD/CAP 与 WorkItem 双轨并行：
   - 优点：改造成本低。
   - 缺点：长期语义冲突与重复维护不可控，已被实践证明会漂移。
2. 仅改编号，不改执行源：
   - 优点：短期影响面较小。
   - 缺点：无法解决模板/门禁/看板不同步，治理闭环仍不稳定。

---

## 版本影响

- 是否影响 API：否
- 是否影响事件模型：否
- 是否影响数据结构：是（执行计划数据结构与编号约束升级）
