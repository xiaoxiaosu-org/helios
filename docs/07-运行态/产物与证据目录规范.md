# 产物与证据目录规范（artifacts/）

本文件定义“命令可验收”的统一证据产物约定，确保智能体与人类都能：
- 运行命令验证 DoD
- 在失败时有可复盘证据
- 在成功时有可审计证据链

## 总则

- 所有可验收能力（CAP）必须通过命令机械验证
- 所有验收命令必须把证据产物写入 `artifacts/`（默认）或 `$ARTIFACTS_DIR`（可覆盖）
- 产物目录不入库（默认应被 `.gitignore` 忽略），在 CI 中通过 “upload artifact” 保存

## 目录结构

默认根目录：`artifacts/`

每次验收运行生成一个 run 目录：

`artifacts/<CAP-ID>/<run-id>/...`

约束：
- `<CAP-ID>` 形如 `CAP-001`
- `<run-id>` 必须唯一且可排序，推荐：`YYYYMMDDTHHMMSSZ-<shortsha>`

## 必备产物

每个 run 目录必须包含：
- `meta.json`：机器可读的验收元信息（CAP、命令、退出码、git sha、时间戳）
- `run.log`：验收过程日志（stdout/stderr 合并）

建议包含：
- `inputs/`：验收输入（配置快照、参数、请求样例等）
- `outputs/`：验收输出（报告、截图、录屏、查询结果等）

## meta.json 规范（最小字段）

字段（最小集合）：
- `capId`：例如 `CAP-004`
- `runId`：目录名
- `timestamp`：ISO 8601
- `gitSha`：当前 HEAD
- `command`：实际执行的命令（含参数）
- `exitCode`：整数
- `status`：`pass` / `fail` / `blocked` / `error`

## 返回码约定

验收命令必须遵守以下返回码语义：
- `0`：通过（pass）
- `1`：失败（fail，断言不满足）
- `2`：阻塞（blocked，缺少前置条件/未配置/未实现）
- `3`：脚本内部错误（error）

## CI 产物保存约定

当 CAP 验收在 CI 运行时：
- 必须上传 `artifacts/<CAP-ID>/...` 作为 workflow artifacts
- 若验收失败，仍需上传证据产物（用于复盘）

