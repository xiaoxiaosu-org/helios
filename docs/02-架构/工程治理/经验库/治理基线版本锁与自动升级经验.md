# 治理基线版本锁与自动升级经验

> 适用范围：希望把工程治理能力跨仓库复用，并避免长期依赖人工提醒同步。

## 问题

常见失败模式：
- 规则只在当前仓库“临时有效”，迁移到新仓库后丢失。
- 门禁规则变更后，下游仓库长期滞后。
- 文档写了“要同步”，但没有机器可执行约束。

## 方案

1. 引入治理锁文件 `governance.lock`，固化来源、版本、提交。
2. 引入治理清单 `governance/baseline/manifest.txt`，明确受管文件。
3. 统一同步入口 `scripts/governance/sync-baseline.sh`。
4. 在 CI 接入 `scripts/ci/governance-lock-check.sh`。
5. 用 `governance-auto-sync.yml` 做定时上游检查和自动升级 PR。

## 关键实现

- 锁校验：`scripts/governance/enforce-lock.sh`
- 上游检测：`scripts/governance/check-release.sh`
- 聚合门禁：`scripts/ci/verify.sh`
- CI 门禁：`.github/workflows/quality-gates.yml`
- 计划模板校验：`scripts/ci/plan-template-check.sh`
- backlog 新鲜度校验：`scripts/workflow/backlog.sh check`

## 为什么有效

- 从“靠人记得同步”变成“锁文件 + CI 硬门禁”。
- 从“单仓库治理”变成“可发布的治理基线”。
- 从“发现滞后靠人工巡查”变成“定时自动提升级 PR”。

## 迁移步骤（最小闭环）

1. 在目标仓库执行 `scripts/governance/sync-baseline.sh --source-repo <repo> --source-ref <ref> --role consumer --force`。
2. 执行 `scripts/dev/install-git-hooks.sh`。
3. 执行 `scripts/ci/verify.sh`。
4. 配置 required checks（`quality-gates`、`checks`）。

## 验收标准

- 目标仓库存在 `governance.lock` 且字段完整。
- `scripts/ci/governance-lock-check.sh` 在本地与 CI 都通过。
- 定时任务可自动创建治理升级 PR。
