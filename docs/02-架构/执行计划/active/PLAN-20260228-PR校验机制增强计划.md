# PLAN-20260228：PR 校验机制增强计划（防遗忘版）

## 目标

将“复盘发现的问题”固化为可执行机制，避免再次出现“CI 绿但规则失效”。

## 范围

- 门禁脚本有效性回归（正反例）
- push 事件 diff/commit range 计算鲁棒性
- 治理文档、经验库、ADR 同步留痕

## 分阶段计划

| 阶段 | 目标 | 交付物 | 验收命令 | 状态 |
|---|---|---|---|---|
| P1 | 门禁自测落地 | `scripts/ci/gate-selftest.sh` + `scripts/ci/verify.sh` 接入 | `scripts/ci/gate-selftest.sh` | Done |
| P2 | CI 稳定性增强 | `doc-check.yml`/`quality-gates.yml` 增加 before SHA 不可达回退 | 触发 push 场景并观察 checks/quality-gates 通过 | Done |
| P3 | 治理与经验固化 | 对照清单、经验库、ADR、路线图同步更新 | `scripts/docs/git-governance-sync-check.sh` | Done |

## 持续动作（每次规则变更必须执行）

1. 新增/修改门禁脚本时，同步补 `gate-selftest` 正反例。
2. 任何使用 `github.event.before` 的 workflow 步骤，必须包含不可达回退逻辑。
3. PR 描述必须附验证命令与关键产物路径。

## 风险提示

- 若后续引入语言级静态分析器（TS/Java/Python），需分栈落地，避免一次性替换造成噪音。
- 若后续增加多仓库复用，应将 `gate-selftest` 模式提炼为模板脚本并版本化。
