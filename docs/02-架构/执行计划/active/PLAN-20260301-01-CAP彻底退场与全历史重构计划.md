# PLAN-20260301-01：CAP彻底退场与全历史重构计划

## 背景与目标

- 背景：项目执行主模型已切换到 WorkItem，但仓库内仍保留大量 CAP 术语、脚本入口、门禁命名与历史记录，形成双语义并存。
- 问题：CAP 与 WI 并存导致执行与验收口径分裂，存在状态漂移、脚本维护重复、治理认知成本上升等风险。
- 目标：彻底移除 CAP 作为执行语义，不做兼容迁移；统一为 WI 单一执行源，并将历史记录完整重写到 WI 语义体系。
- 非目标：不新增业务功能；不引入新的执行模型；不保留 CAP 别名入口。

## WorkItem 清单

状态枚举：`todo` / `in_progress` / `blocked` / `done`

| WorkItem | 类型 | 标题 | Owner | 状态 | 验收命令 | 证据目录 |
|---|---|---|---|---|---|---|
| WI-PLAN2026030101-01 | initiative | 制定CAP退场总方案与里程碑 | repo-owner | in_progress | `scripts/workflow/run.sh WI-PLAN2026030101-01 progress` | `artifacts/workflow/` |
| WI-PLAN2026030101-02 | task | 移除CAP执行入口并统一WI执行语义 | repo-owner | todo | `scripts/workflow/run.sh WI-PLAN2026030101-02 progress` | `artifacts/workflow/` |
| WI-PLAN2026030101-03 | task | 重构CI门禁为WI状态同步并删除CAP专用检查 | repo-owner | todo | `scripts/workflow/run.sh WI-PLAN2026030101-03 progress` | `artifacts/workflow/` |
| WI-PLAN2026030101-04 | task | 重写工程治理文档与模板中的CAP术语 | repo-owner | todo | `scripts/workflow/run.sh WI-PLAN2026030101-04 progress` | `artifacts/workflow/` |
| WI-PLAN2026030101-05 | task | 重写执行计划历史记录并移除CAP编号痕迹 | repo-owner | todo | `scripts/workflow/run.sh WI-PLAN2026030101-05 progress` | `artifacts/workflow/` |
| WI-PLAN2026030101-06 | task | 重构验收脚本与证据目录到WI命名体系 | repo-owner | todo | `scripts/workflow/run.sh WI-PLAN2026030101-06 progress` | `artifacts/workflow/` |
| WI-PLAN2026030101-07 | task | 全仓校验与退场发布说明 | repo-owner | todo | `scripts/workflow/run.sh WI-PLAN2026030101-07 progress` | `artifacts/workflow/` |

## 推进记录

| 日期 | WorkItem | 动作 | 结果 | 备注 |
|---|---|---|---|---|
| 2026-03-01 | WI-PLAN2026030101-01 | 初始化计划 | pass | 自动创建首个 WorkItem |
| 2026-03-01 | WI-PLAN2026030101-02 ~ WI-PLAN2026030101-07 | 计划拆解入库 | pass | CAP 退场重构任务已入 backlog 主链路 |

## 验收与证据

- 统一验收入口：`scripts/workflow/run.sh <WI-PLANYYYYMMDDNN-NN> [start|progress|close|full]`
- 统一证据目录：`artifacts/workflow/<WI-ID>/<run-id>/`
- 事件追踪文件：`artifacts/workflow/events/<WI-ID>.jsonl`
- 退场完成判定：
  1) 仓库执行入口、CI 门禁、治理文档不再出现 CAP 作为执行语义；
  2) 历史执行计划与相关治理文档完成 WI 语义重写；
  3) 不保留 CAP 别名脚本与兼容桥接逻辑；
  4) `scripts/ci/verify.sh` 与计划门禁全量通过。

## 风险与阻塞

- 风险：历史文档重写范围大，若批量替换策略不严谨，可能引入事实偏差或引用断链。
- 风险：移除 CAP 专用脚本后，短期可能出现门禁命令习惯迁移成本。
- 阻塞：尚未建立“历史重写完成度”自动校验规则。
- 解除阻塞动作：先固化重写清单与校验脚本，再分批重写并在每批次后执行全量校验。

## 下一步

1. 先执行 `WI-PLAN2026030101-02`，移除 CAP 执行入口并更新 workflow 命令主链路。
2. 执行 `WI-PLAN2026030101-03`，将 CAP 专用 CI 检查替换为 WI 状态一致性门禁。
3. 执行 `WI-PLAN2026030101-04/05`，完成治理文档与历史计划全量重写。
4. 执行 `WI-PLAN2026030101-06/07`，收敛证据目录与全仓验收，输出退场发布说明。
