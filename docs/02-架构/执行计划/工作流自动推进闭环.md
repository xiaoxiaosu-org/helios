# 工作流自动推进与闭环（TD/CAP）

本文定义技术债与执行计划的统一编排入口，目标是把“追踪-验证-推进-闭环”变成可执行流程，而非依赖会话记忆。

## 单一事实源

- 工作流映射：`docs/02-架构/执行计划/workflow-map.yaml`
- 技术债清单：`docs/02-架构/技术债清单.md`
- 路线图计划：`docs/02-架构/执行计划/active/PLAN-20260227-工程智能化路线图.md`
- ADR 索引：`docs/09-ADR-架构决策/ADR-索引.md`

`workflow-map.yaml` 维护以下信息：
- `TD -> CAP` 对应关系
- 触发路径（哪些改动会触发文档联动检查）
- 必需同步文档
- 验收命令列表（Acceptance Commands）
- 闭环检查要求

## 命令入口

- 启动：`scripts/workflow/start.sh TD-001`
- 推进：`scripts/workflow/progress.sh TD-001`
- 闭环：`scripts/workflow/close.sh TD-001`
- 一键执行：`scripts/workflow/run.sh TD-001 full`

行为说明：
- `start`：在 `main` 自动创建工作分支、更新 TD 状态为 `In Progress`、生成 checklist。
- `progress`：按 map 顺序执行验收命令并产出报告。
- `close`：先重跑 `progress`，再做必需文档/闭环条件检查并产出闭环报告。

## CI 自动化联动

- 质量门禁：`scripts/ci/workflow-sync-check.sh`
  - 当改动命中 workflow map 的 `trigger_paths` 时，必须同步修改 `required_docs` 中至少一项。
- 定时巡检：`.github/workflows/tech-debt-sweep.yml`
  - 每日执行技术债治理检查与 workflow 联动检查。

## 推荐会话触发语句

- `启动 TD-001 闭环`
- `推进 TD-001`
- `闭环 TD-001`

协作约定：收到上述语句后，默认按 `start -> progress -> close` 执行，并同步输出结构化结果。
