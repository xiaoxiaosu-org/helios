# 边界与依赖规则（CAP-004）

本文件定义顶层代码目录的依赖方向，用于 `scripts/ci/arch-check.sh` 机械校验。

## 适用范围
- 目录：`apps/`、`services/`、`modules/`、`src/`
- 语言：脚本按 import/require/from 语句做静态扫描（多语言通用正则）

## 依赖方向矩阵（允许）

| 来源目录 | 允许依赖 |
|---|---|
| `apps/` | `apps/`、`services/`、`modules/` |
| `services/` | `services/`、`modules/` |
| `modules/` | `modules/` |
| `src/` | `src/` |

补充约束：
- `src/` 与 `apps/services/modules` 视为两套不同结构，不允许跨体系直接依赖。
- 外部依赖（例如 npm/pypi/maven 包）不在本规则检查范围内。

## 违规示例
- `modules/*` 直接 import `services/*` 或 `apps/*`
- `services/*` 直接 import `apps/*`
- `src/*` 直接 import `services/*` 或 `modules/*`

## 修复步骤
1. 根据上表调整 import 方向，把上层依赖下沉到允许层级。
2. 如需跨层能力，优先下沉到 `modules/`（或在 `src/` 体系内抽公共模块）。
3. 修复后执行：`scripts/ci/arch-check.sh --out <产物目录>`

## 关联门禁
- 本地/CI 统一检查：`scripts/ci/arch-check.sh`
- CAP 验收入口：`scripts/cap/verify.sh CAP-004`
